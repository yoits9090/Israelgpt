# Grafana Agent configuration for Prometheus metrics
# Scrapes the bot's /metrics endpoint and pushes to Grafana Cloud

server:
  log_level: warn

metrics:
  global:
    scrape_interval: 15s
    external_labels:
      app: guildest
      env: production
  configs:
    - name: guildest
      scrape_configs:
        - job_name: guildest_bot
          static_configs:
            - targets: ['guildest-bot:8000']
              labels:
                instance: ec2
      remote_write:
        - url: "${GRAFANA_REMOTE_WRITE_URL}"
          basic_auth:
            username: "${GRAFANA_METRICS_USER}"
            # Combine split API key chunks to avoid storing the full secret in a single env var.
            # Leave GRAFANA_API_KEY unset when using the split form to prevent duplication.
            password: "${GRAFANA_API_KEY_PREFIX}${GRAFANA_API_KEY_SUFFIX}${GRAFANA_API_KEY}"
